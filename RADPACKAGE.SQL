SET PAGESIZE  50000
SET LINESIZE  32767
SET LONG 327670 
SET LONGCHUNKSIZE 327670 
SET TRIMOUT ON 
SET TRIMSPOOL ON
SET FEEDBACK OFF;
SET HEADING OFF;
SET VERIFY OFF;
SET ESCAPE '\'
column SPOOLSQL new_val SPOOLSQL
column SPOOLSPC new_val SPOOLSPC
column DYNSPOOL new_val DYNSPOOL
SELECT  '&2'||'/SQL/' SPOOLSQL FROM DUAL;
SELECT  '&2'||'/SPC/' SPOOLSPC FROM DUAL;
SELECT  '&2'||'/SQL/DYNSPOOL.SQL' DYNSPOOL FROM DUAL;
SPOOL &DYNSPOOL;
PROMPT SET PAGESIZE  50000
PROMPT SET LINESIZE  32767
PROMPT SET LONG 100000
PROMPT SET LONGCHUNKSIZE 100000
PROMPT SET TRIMOUT ON
PROMPT SET TRIMSPOOL ON 
PROMPT SET FEEDBACK OFF;
PROMPT SET HEADING OFF;
PROMPT SET SQLBLANKLINES OFF;
PROMPT SET VERIFY OFF;
SELECT SPOOL_START || CHR(10) || SPOOL_BODY || CHR(10) || SPOOL_END
FROM (SELECT ROWNUM ROW_NUM,
'SPOOL '||'&SPOOLSQL'|| OBJECT_NAME || '.sql;' SPOOL_START,
'select dbms_metadata.get_ddl(''PACKAGE_BODY'',''' ||
OBJECT_NAME || ''', user) from dual;' SPOOL_BODY,
'SPOOL OFF;' SPOOL_END
FROM USER_OBJECTS
WHERE REPLACE(OBJECT_NAME,'_','~') LIKE '%&1~%'
AND OBJECT_TYPE = 'PACKAGE');
SELECT SPOOL_START || CHR(10) || SPOOL_BODY || CHR(10) || SPOOL_END
FROM (SELECT ROWNUM ROW_NUM,
'SPOOL '||'&SPOOLSPC'|| OBJECT_NAME || '.spc;' SPOOL_START,
'select dbms_metadata.get_ddl(''PACKAGE_SPEC'',''' ||
OBJECT_NAME || ''', user) from dual;' SPOOL_BODY,
'SPOOL OFF;' SPOOL_END
FROM USER_OBJECTS
WHERE REPLACE(OBJECT_NAME,'_','~') LIKE '%&1~%'
AND OBJECT_TYPE = 'PACKAGE');
PROMPT SET SQLBLANKLINES ON;
PROMPT SET FEEDBACK ON;
PROMPT SET HEADING ON;
PROMPT SET VERIFY ON;
PROMPT EXIT;
SPOOL OFF;
@&DYNSPOOL;
EXIT;